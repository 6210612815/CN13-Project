{% extends "layout.html" %}
{% load static %}
{% block title %}<title>My Booking</title>{% endblock %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{% static '/css/mybookings.css' %}">
<script src="{% static '/js/styles.js' %}"></script>
<script type="text/javascript" src="/static/js/styles.js"></script>
{% endblock %}

{% block body %}
    <script>
        liff.init({ liffId: "1657196715-wb3NDYPR" }, () => {
            if (!liff.isLoggedIn()) {
                liff.login();
            }else{
                liff.getProfile().then(profile => {
                    document.getElementById("userId_booking").value = profile.userId;
                    document.getElementById("userId_booking0").value = profile.userId;
                    document.getElementById("userId_booking1").value = profile.userId;
                    document.getElementById("userId_booking2").value = profile.userId;
                    document.getElementById("userId_booking3").value = profile.userId;
                    document.getElementById("userId_favorite").value = profile.userId;

                }).catch((err) => {
                    console.log(err);
                });
            }
        }, err => console.error(err.code, error.message));
    </script> 

    <div class="container">
        <h1>My Booking</h1>
        <div class="sub-contain">
            <div class="side-menu close">
                <ul class="sub-menu">
                    <li><p>Sort By</p></li>
                    <li>
                        <form method="post" action="{% url 'mybooking' %}">
                            {% csrf_token %}
                            <input type="hidden" id="userId_booking0" name="userId" value="">
                            <input type="submit" value="All">
                        </form>
                    </li>  
                    <li>
                        <form method="post" action="{% url 'my_booking_not_return' %}">
                            {% csrf_token %}
                            <input type="hidden" id="userId_booking1" name="userId" value="">
                            <input type="submit" value="Booking">
                        </form>
                    </li>    
                    <li>
                        <form method="post" action="{% url 'my_booking_return' %}">
                            {% csrf_token %}
                            <input type="hidden" id="userId_booking2" name="userId" value="">
                            <input type="submit" value="Returned">
                        </form>
                    </li>
                    <li>
                        <form method="post" action="{% url 'my_booking_overdue' %}">
                            {% csrf_token %}
                            <input type="hidden" id="userId_booking3" name="userId" value="">
                            <input type="submit" value="Overdue">
                        </form>
                    </li> 
                </ul>
            </div>

            <div class ="list-container">
                <div class="list">
                    {% for s in statistic %}
                        <img src="{% static s.item.pic %}">
                        <div class="text">
                            <p>{{ s.item }}</p>
                            {% if s.return_datetime is None %}
                                {% if s.due_datetime > now %}
                                    <div class="status-line"><p>Status: <div class="btn-borr">Booking</div></p></div>
                                    <p class="txt-small">Booking date: {{ s.booking_datetime }}</p>
                                    <p class="txt-small">Due date: {{ s.due_datetime }}</p>
                                    <p class="txt-small">Return date: -</p> 
                                {% else %}  
                                    <div class="status-line"><p>Status: <div class="btn-over">Overdue</div></p></div>
                                    <p class="txt-small">Booking date: {{ s.booking_datetime }}</p>
                                    <p class="txt-small">Due date: {{ s.due_datetime }}</p>
                                    <p class="txt-small">Return date: -</p>
                                {% endif %} 
                            {% else %}
                                <div class="status-line"><p>Status: <div class="btn-return">Returned</div></p></div>
                                <p class="txt-small">Booking date: {{ s.booking_datetime }}</p>
                                <p class="txt-small">Due date: {{ s.due_datetime }}</p>
                                <p class="txt-small">Return date: {{ s.return_datetime }}</p>
                            {% endif %}    
                        </div>
                    {% empty %}
                        <p class="txt-small">No item found</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}

